let code = '';
let isRolling = false;
let theWheel = new Winwheel({
	'numSegments': 6,
	'drawMode': 'image',
	'imageOverlay': true,
	'outerRadius': 1,
	'lineWidth': 0.0001,
	'segments':
		[
			{ 'text': 'rs-card-10k', 'id': 1 },
			{ 'text': 'rs-lucky', 'id': 2 },
			{ 'text': 'rs-xe-Vin', 'id': 3 },
			{ 'text': 'rs-lucky', 'id': 4 },
			{ 'text': 'rs-guong', 'id': 5 },
			{ 'text': 'rs-lucky', 'id': 6 },
		],
	'animation':
	{
		'type': 'spinToStop',
		'duration': 8,
		'spins': 4,
		'callbackFinished': alertPrize
		// 'callbackAfter' : 'drawTriangle()'
	}
});

let firstImg = new Image();

firstImg.onload = function () {
	theWheel.wheelImage = firstImg;    // Make wheelImage equal the loaded image object.
	theWheel.draw();                   // Also call draw function to render the wheel.
}

firstImg.src = "Web/images/wheel.png";

function get(url) {
    return new Promise((resolve, reject) => {
        const req = new XMLHttpRequest();
        req.open('GET', url);
        req.onload = () => req.status === 200 ? resolve(req.response) : reject(Error(req.statusText));
        req.onerror = (e) => reject(Error(`Network Error: ${e}`));
        req.send();
    });
}


function calculatePrize(index, coupon) {
    theWheel.stopAnimation(false);
    theWheel.rotationAngle = 0;
    theWheel.draw();

    code = coupon

    let stopAt = theWheel.getRandomForSegment(index);
    theWheel.animation.stopAngle = stopAt;

    theWheel.startAnimation();
}

function alertPrize(indicatedSegment) {
    isRolling = false;
    switch (indicatedSegment.id) {
        case 1:
			$(".modal").removeClass("show");
			$('#popup-trung-the').addClass('show');
			$(".modal-backdrop").addClass("show");
			$("body").addClass("no-scroll");
			$(".submit-btn").attr('disabled', false);
            break;
		case 2:
			$(".modal").removeClass("show");
			$('#popup-chuc-may-man').addClass('show');
			$(".modal-backdrop").addClass("show");
			$("body").addClass("no-scroll");
			$(".submit-btn").attr('disabled', false);
            break;
        case 3:
			$(".modal").removeClass("show");
			$('#popup-vf3').addClass('show');
			$(".modal-backdrop").addClass("show");
			$("body").addClass("no-scroll");
			$(".submit-btn").attr('disabled', false);
            break;
		case 4:
			$(".modal").removeClass("show");
			$('#popup-chuc-may-man').addClass('show');
			$(".modal-backdrop").addClass("show");
			$("body").addClass("no-scroll");
			$(".submit-btn").attr('disabled', false);
            break;
        case 5:
			$(".modal").removeClass("show");
			$('#popup-trung-guong-led').addClass('show');
			$(".modal-backdrop").addClass("show");
			$("body").addClass("no-scroll");
			$(".submit-btn").attr('disabled', false);
            break;
		case 6:
			$(".modal").removeClass("show");
			$('#popup-chuc-may-man').addClass('show');
			$(".modal-backdrop").addClass("show");
			$("body").addClass("no-scroll");
			$(".submit-btn").attr('disabled', false);
            break;
    }
}
function rollNow(prize) {
	// TODO: This API return {coupon: 'coupon 2', id: '2'}
	if (!isRolling) {
		isRolling = true
		//$('#btn-spin').attr('disabled', true);
		calculatePrize(prize, "")
	}
}